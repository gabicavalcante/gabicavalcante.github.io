<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>gabi cavalcante/posts/matplotlib-searborn-replot/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://gabicavalcante.github.io/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://gabicavalcante.github.io/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://gabicavalcante.github.io/hugo-theme-console/css/console.css">
    <style>
        pre { 
          background-color: white !important;
        }
    </style>
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="A guide to setup plots using seaborn facegrid/replot plots" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gabicavalcante.github.io/posts/matplotlib-searborn-replot/" /><meta property="article:published_time" content="2020-08-15T00:00:00+00:00" />



<meta name="twitter:title" content="A guide to setup plots using seaborn facegrid/replot plots"/>
<meta name="twitter:description" content="Using searborn and matplotlib to make great plobs isn&rsquo;t easy.
I have been loiking on the internet for complete tutorials about how to setup a good plot, but I only found small peaces of tips.
So now I want to show the final plots that I build."/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://gabicavalcante.github.io/" class="no-style site-name">gabi cavalcante</a>:~# 
              <a href='https://gabicavalcante.github.io/posts'>posts</a>/<a href='https://gabicavalcante.github.io/posts/matplotlib-searborn-replot'>matplotlib-searborn-replot</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://gabicavalcante.github.io/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://gabicavalcante.github.io/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://gabicavalcante.github.io/cv/" typeof="ListItem">cv/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast">
        
<h1>A guide to setup plots using seaborn facegrid/replot plots</h1>

Aug. 15, 2020

    // <a href="https://www.linkedin.com/in/gabrielacavalcante/">Linkedin</a>


    // <a href="https://www.twitter.com/_gabiCavalcante">Twitter</a>


    // <a href="https://www.github.com/gabicavalcante">Github</a>

<br/><br/>
<p>Using searborn and matplotlib to make great plobs isn&rsquo;t easy.
I have been loiking on the internet for complete tutorials about how to setup a good plot, but I only found small peaces of tips.
So now I want to show the final plots that I build.</p>
<p>Let&rsquo;s start import all libaries that we need.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
</code></pre></div><p>We need to get some data to our example, so I&rsquo;m going to use the Google Global Mobility Report.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">google_mobility_url <span style="color:#f92672">=</span> (
    <span style="color:#e6db74">&#34;https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv?&#34;</span>
)
dt_original <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(google_mobility_url, low_memory<span style="color:#f92672">=</span>False, parse_dates<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;date&#34;</span>])
</code></pre></div><p>I&rsquo;m going to rename a few columns and select a group of countries to plot the data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">column_names <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;retail_and_recreation_percent_change_from_baseline&#34;</span>: <span style="color:#e6db74">&#34;retail&#34;</span>,
    <span style="color:#e6db74">&#34;grocery_and_pharmacy_percent_change_from_baseline&#34;</span>: <span style="color:#e6db74">&#34;grocery_pharmacy&#34;</span>,
    <span style="color:#e6db74">&#34;parks_percent_change_from_baseline&#34;</span>: <span style="color:#e6db74">&#34;parks&#34;</span>,
    <span style="color:#e6db74">&#34;transit_stations_percent_change_from_baseline&#34;</span>: <span style="color:#e6db74">&#34;transit_stations&#34;</span>,
    <span style="color:#e6db74">&#34;workplaces_percent_change_from_baseline&#34;</span>: <span style="color:#e6db74">&#34;workplaces&#34;</span>,
    <span style="color:#e6db74">&#34;residential_percent_change_from_baseline&#34;</span>: <span style="color:#e6db74">&#34;residential&#34;</span>,
   <span style="color:#e6db74">&#34;country_region&#34;</span>: <span style="color:#e6db74">&#34;locality_name&#34;</span>
}
data <span style="color:#f92672">=</span> dt_original<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>column_names)

<span style="color:#75715e"># filter the data and drop unnecessary columns</span>
regions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Japan&#34;</span>, <span style="color:#e6db74">&#34;South Korea&#34;</span>, <span style="color:#e6db74">&#34;Canada&#34;</span>, <span style="color:#e6db74">&#34;Germany&#34;</span>, <span style="color:#e6db74">&#34;Spain&#34;</span>, <span style="color:#e6db74">&#34;Argentina&#34;</span>, <span style="color:#e6db74">&#34;New Zealand&#34;</span>]
data <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>query(f<span style="color:#e6db74">&#34;locality_name in {regions}&#34;</span>)<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;census_fips_code&#34;</span>, <span style="color:#e6db74">&#34;metro_area&#34;</span>, <span style="color:#e6db74">&#34;iso_3166_2_code&#34;</span>, <span style="color:#e6db74">&#34;sub_region_1&#34;</span>, <span style="color:#e6db74">&#34;sub_region_2&#34;</span>])
</code></pre></div><p>A simple plot</p>
<pre><code>sns.relplot(
      x=&quot;date&quot;, 
      y=&quot;value&quot;, 
      hue=&quot;category&quot;, 
      data = data_to_plot, 
      col=&quot;locality_name&quot;
)
</code></pre><p>The final results</p>
<pre><code>import matplotlib.dates as mdates


# you can set the style to be one of white, dark, whitegrid, darkgrid, ticks
sns.set_style('darkgrid', {'legend.frameon': True})

# lets melt the data to plot
id_vars = [&quot;country_region_code&quot;, &quot;locality_name&quot;, &quot;date&quot;]
data_to_plot = data.melt(
    id_vars,
    var_name=&quot;category&quot;, 
    value_name=&quot;value&quot;
).query('locality_name==&quot;Argentina&quot;')


long_regions_plot = sns.relplot(
      x=&quot;date&quot;, 
      y=&quot;value&quot;, 
      hue=&quot;category&quot;, 
      data = data_to_plot, 
      col=&quot;locality_name&quot;, 
      col_wrap=2, 
      kind=&quot;line&quot;, 
      height=6, 
      legend=&quot;brief&quot;, 
      aspect=1.5, 
      markers=True, 
      dashes=True
  )

        
long_regions_plot._legend.remove()

# Iterate thorugh each axis
for ax in long_regions_plot.axes:
    ax.set(xlabel='Date', ylabel='') 

    handles, labels = ax.get_legend_handles_labels()
    if handles:
      set_labels = ['Retail &amp; Recreation', 'Grocery &amp; Pharmacy', 'Parks', 'Transit Stations', 'Workplaces']
      ax.legend(handles=handles[1:], labels=set_labels, title=&quot;&quot;, fontsize=11, title_fontsize=11)
    

    # Make x and y-axis labels slightly larger
    ax.set_xlabel(ax.get_xlabel(), fontsize=14)
    ax.set_ylabel(ax.get_ylabel(), fontsize=14)

    # Make title more human-readable and larger
    if ax.get_title():
        final_txt = ax.get_title().split('=')[1].strip().capitalize()
        ax.set_title(final_txt, fontsize=20)

    #set ticks every week
    ax.xaxis.set_major_locator(mdates.WeekdayLocator())
    
    #set major ticks format
    ax.xaxis.set_major_formatter(mdates.DateFormatter('%b'))
    ax.xaxis.set_major_locator(mdates.WeekdayLocator(interval=5))


# now I want to show line for restriction date and easy restriction date
from datetime import datetime

restriction_date = datetime.strptime('2020-02-23', '%Y-%m-%d') 
ease_restriction_date = datetime.strptime(&quot;2020-05-11&quot;, '%Y-%m-%d')

plt.axvline(restriction_date, color='k', linestyle='dashed', linewidth=1)
plt.axvline(ease_restriction_date, color='k', linestyle='dashed', linewidth=1)

# tick label size
plt.tick_params(axis='both',labelsize=13)

# set a range for y axis
axes = plt.gca() 
axes.set_ylim([-120, 220])
</code></pre>


        <div class="footer">
    Powered by <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
